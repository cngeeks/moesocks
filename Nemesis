import Prelude ()
import System.Nemesis.Env
import Air.Env
import Control.Monad

main = run nemesis

ping = do
        sh "curl -x socks5://localhost:1090 localhost:8080; exit 0"

nemesis = do

  desc "halive"
  task "halive" - do
    sh "halive src/HaliveMain.hs src"


  desc "dist"
  task "dist" - do
    sh "cabal clean"
    sh "cabal configure"
    sh "cabal sdist"


  desc "test"
  task "test" - do
    forever - do
      ping
      sleep 1

  desc "ping"
  task "ping" - ping

  desc "remote"
  task "remote" - do
    sh "cabal run -- -m remote -c dev.json +RTS -N1"
  
  desc "local"
  task "local" - do
    sh "cabal run -- -m local -c dev.json"

  desc "local2"
  task "local2" - do
    sh "cabal run -- -m local -c dev2.json"
  
  desc "i"
  task "i" - do
    sh "cabal repl"

  desc "debug local"
  task "dl" - do
    sh "cabal run -- -m local -c config.json"
  
  desc "debug remote"
  task "dr" - do
    sh "cabal run -- -m remote -c config.json"


  desc "merge debug to master"
  task "m" - do
    sh "git checkout master"
    sh "git merge debug"
    sh "git push origin master"
    sh "git checkout debug"

